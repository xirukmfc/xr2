# xR2 Platform - Docker Deployment Guide

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
git clone <your-repo>
cd xR2
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

### 2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Makefile
```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make dev

# –ò–ª–∏ –ø–æ—à–∞–≥–æ–≤–æ:
make build
make up
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
make status
make health
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Makefile

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make help` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É |
| `make build` | –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã |
| `make up` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã |
| `make down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã |
| `make restart` | –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã |
| `make logs` | –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |
| `make logs-app` | –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `make status` | –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ |
| `make health` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–æ–≤ |
| `make clean` | –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã |
| `make backup-db` | –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î |
| `make monitor` | –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env —Ñ–∞–π–ª)

**–í–ê–ñ–ù–û**: –ò–∑–º–µ–Ω–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –ø–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –≤ production!

```bash
# Database
POSTGRES_PASSWORD=your_secure_password
DATABASE_URL=postgresql://xr2_user:password@postgres:5432/xr2_db

# Redis
REDIS_PASSWORD=your_redis_password
REDIS_URL=redis://:password@redis:6379/0

# Security
SECRET_KEY=your_super_secret_key_minimum_32_chars
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_admin_password

# Rate Limiting
RATE_LIMIT_PER_MINUTE=60
MAX_REQUESTS_PER_IP_PER_MINUTE=100
MAX_REQUESTS_PER_API_KEY_PER_MINUTE=1000

# Environment
ENVIRONMENT=production
DEBUG=false
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫:

1. **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ IP –∏ API –∫–ª—é—á–∞–º
2. **DDoS Protection** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö IP
3. **Request Filtering** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **Security Headers** - –∑–∞—â–∏—Ç–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
5. **Nginx Protection** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–∫—Å–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

- **API Rate Limit**: 60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **IP Block Duration**: 5 –º–∏–Ω—É—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
- **Suspicious Request Detection**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- **Bot Protection**: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–æ—Ç–æ–≤ –∏ —Å–∫–∞–Ω–µ—Ä–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: http://localhost
- **API Docs**: http://localhost/docs
- **Admin Panel**: http://localhost/admin
- **Admin Docs**: http://localhost/admin-docs

### –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

- HTTP –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –°—Ç–∞—Ç—É—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- Redis –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Nginx —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ë—ç–∫–∞–ø –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
make backup-db

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
make restore-db BACKUP_FILE=backup_20241209_143022.sql
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:

```bash
# –ß–µ—Ä–µ–∑ Docker
make db-shell

# –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql -h localhost -p 5432 -U xr2_user -d xR2_db
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
make update

# –ò–ª–∏ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
make clean
make build
make up
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make logs

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
make logs-app
make logs-nginx
make logs-db
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º:

```bash
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
make shell

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
make db-shell
```

## üìà Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Make (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
sudo apt-get install make
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
mkdir -p nginx/ssl
# –ü–æ–º–µ—Å—Ç–∏—Ç–µ –≤–∞—à–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ nginx/ssl/
```

### 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:

```bash
# Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
make deploy-prod
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞:

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 22
sudo ufw enable
```

## üîß Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü–æ—Ä—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
   ```bash
   sudo lsof -i :8000
   sudo kill -9 <PID>
   ```

2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏**:
   ```bash
   sudo chown -R $USER:$USER .
   ```

3. **–û—á–∏—Å—Ç–∫–∞ Docker**:
   ```bash
   make clean
   docker system prune -a
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
curl http://localhost/health
curl http://localhost/internal/health
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `make logs`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `make status`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ: `make health`
4. –û—á–∏—Å—Ç–∏—Ç–µ –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `make clean && make build && make up`

---

**–£–¥–∞—á–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è! üöÄ**
