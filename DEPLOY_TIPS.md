# üöÄ –°–æ–≤–µ—Ç—ã –ø–æ —É—Å–∫–æ—Ä–µ–Ω–∏—é –¥–µ–ø–ª–æ—è Frontend

## –ü—Ä–æ–±–ª–µ–º–∞
Frontend —Å Monaco Editor –∏ —Ç—è–∂–µ–ª—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (~590MB) –¥–æ–ª–≥–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ Docker (15+ –º–∏–Ω—É—Ç).

## ‚úÖ –ß—Ç–æ –º—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏

### 1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω Dockerfile
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω memory limit –¥–ª—è Node.js: `NODE_OPTIONS="--max-old-space-size=4096"`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è pnpm: `network-timeout 600000`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `corepack` –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ pnpm
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `--prefer-offline` –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω docker-compose.prod.yml
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã –ª–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏: 4GB max, 2GB reserved
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω shared memory: `shm_size: 2gb`
- ‚úÖ –í–∫–ª—é—á–µ–Ω BuildKit cache: `BUILDKIT_INLINE_CACHE: 1`
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω `start_period` healthcheck –¥–æ 60s

## üéØ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
./deploy-optimized.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
```bash
# –í–∫–ª—é—á–∏—Ç—å BuildKit
export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1

# –°–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ frontend —Å –≤—ã–≤–æ–¥–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
docker compose --env-file .env.prod -f docker-compose.prod.yml build --progress=plain frontend

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose --env-file .env.prod -f docker-compose.prod.yml up -d
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –±–µ–∑ –∫—ç—à–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã)
```bash
docker compose --env-file .env.prod -f docker-compose.prod.yml build --no-cache frontend
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–±–æ—Ä–∫–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ frontend –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
docker compose --env-file .env.prod -f docker-compose.prod.yml logs -f frontend
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
docker stats xr2_frontend_prod
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–±–æ—Ä–∫–∏
```bash
docker compose --env-file .env.prod -f docker-compose.prod.yml ps
```

## ‚ö° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏:

1. **–°–æ–±—Ä–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
docker compose --env-file .env.prod -f docker-compose.prod.yml build frontend
docker save -o frontend-image.tar xr2-frontend_prod
scp frontend-image.tar your-server:/path/

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker load -i frontend-image.tar
```

2. **–£–≤–µ–ª–∏—á–∏—Ç—å swap –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** (–µ—Å–ª–∏ –º–∞–ª–æ RAM):
```bash
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

3. **–û—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ –≤ Docker:**
```bash
docker system prune -a --volumes
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ "pnpm install"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –£–≤–µ–ª–∏—á—å—Ç–µ timeout: `pnpm config set network-timeout 900000`
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–µ –∑–µ—Ä–∫–∞–ª–æ: `pnpm config set registry https://registry.npmjs.org/`

### –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç —Å "out of memory"
- –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ docker-compose.prod.yml (memory: 6G)
- –î–æ–±–∞–≤—å—Ç–µ swap –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö build workers –≤ next.config.mjs

### –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞, –Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs xr2_frontend_prod`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ healthcheck: `docker inspect xr2_frontend_prod | grep -A 10 Health`

## üìà –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏

- **–° –∫—ç—à–µ–º:** 3-5 –º–∏–Ω—É—Ç
- **–ë–µ–∑ –∫—ç—à–∞ (–ø–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞):** 8-12 –º–∏–Ω—É—Ç
- **–° –º–µ–¥–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º:** –¥–æ 15 –º–∏–Ω—É—Ç

## üí° –í–∞–∂–Ω–æ

- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É
- BuildKit –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç —Å–±–æ—Ä–∫—É
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–º–∏–Ω–∏–º—É–º 5GB)
